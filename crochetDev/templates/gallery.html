<html>
<head>
	<script src="http://code.jquery.com/jquery.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		$("document").ready(function(){
			showfollow();
			$("#follow").click(function(){
				followclick($(this));
			});

			$(".save").click(function(){
				savepattern($(this));
			});

			$(".remove").click(function(){
				removepattern($(this));
			});

			$(".delpattern").click(function(){
				deletepattern($(this));
			});
		});

		function followclick(button){
			if(button.attr("status") == "True"){
				$.getJSON("/follow/", {'action':'unfollow', 'person': button.attr("username")},
				
				function(data){
					$("#follow").attr("status", "False");
					showfollow();
				});

			} else {
				$.getJSON("/follow/", {'action':'follow', 'person' :  button.attr("username")},
				
				function(data){
					$("#follow").attr("status", "True");
					showfollow();
				});
			}	
		};

		function showfollow(){
			follow = $("#follow").attr("status")
			if (follow == "True") {
				$("#follow_instructions").html("You are following " + $("#follow").attr("username"));
				$("#follow").html("Unfollow");
			} else {
				$("#follow_instructions").html("You are not following " + $("#follow").attr("username"));
				$("#follow").html("Follow");
			}
		}

		function savepattern(button){
			username = button.attr("username")
			patternname = button.attr("patternname")
		
			$.getJSON("/savepattern/", {'person':username, 'pattern':patternname},
			
			function(data){
				button.attr("disabled", "");
				button.html("Already saved");
			});
		};

		function removepattern(button){
			username = button.attr("username");
			patternname = button.attr("patternname");
			console.log("person is "+ username);
			console.log("pattern is "+ patternname);
		
			$.getJSON("/removepattern/", {'person':username, 'pattern':patternname},
			
			function(data){
				button.parent().parent().remove();
			});	
		}

		function deletepattern(button){
			id = button.attr("patternid");

			$.getJSON("/deletepattern/", {'patternid':id },
				function(data){
					button.parent().parent().remove();
			});
		};

	</script>
	<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap.no-icons.min.css" rel="stylesheet" media="screen">
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.0.2/css/font-awesome.css" rel="stylesheet">
	<style>
	.btn-custom {
  		  background-color: hsl(198, 100%, 12%) !important;
		  background-repeat: repeat-x;
		  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#005c84", endColorstr="#002a3d");
		  background-image: -khtml-gradient(linear, left top, left bottom, from(#005c84), to(#002a3d));
		  background-image: -moz-linear-gradient(top, #005c84, #002a3d);
		  background-image: -ms-linear-gradient(top, #005c84, #002a3d);
		  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #005c84), color-stop(100%, #002a3d));
		  background-image: -webkit-linear-gradient(top, #005c84, #002a3d);
		  background-image: -o-linear-gradient(top, #005c84, #002a3d);
		  background-image: linear-gradient(#005c84, #002a3d);
		  border-color: #002a3d #002a3d hsl(198, 100%, 8.5%);
		  color: #fff !important;
		  text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.23);
		  -webkit-font-smoothing: antialiased;
	}
	</style>
</head>

<body>


	<h1>Stitch-It</h1>
	<h1>{{viewing.username}}'s Gallery</h1>
		{% if request.user.is_authenticated %}
			<form action="/accounts/logout/" method="get">
		            <input type="submit" value="Logout" class="btn btn-custom"\>
		    </form>
		    <a href="/{{request.user.username}}/">My Gallery</a>
		    <a href="/{{request.user.username}}/untitled/">Create new pattern</a>
		    <a href="/newsfeed/">Browse Projects</a>
		    <a href="/inbox/">Inbox ({{request.session.inbox_unread}})</a>

		{% endif %}

		{% if viewing != request.user and user.is_authenticated %}
		<span id="follow_instructions"></span>
        <button type="button" id="follow" username="{{viewing.username}}" status="{{following}}" class="btn btn-custom"></button>
        {% endif %}

		{% for pattern in published %}
		<div class="patternbox">
			<div class="patternimage" style="height:200px; width:200px; background-color:#FFB968;">
			</div>
			<div class="patterninfo">
				<div class="patternname"><a href="/{{pattern.user.username}}/{{pattern.id}}/">{{pattern.name}}</a> </div>
				<div class="patterncreated">{{pattern.date_published|date}}</div>
				<div class="patterntagset">
					{% for tag in pattern.tag_set.all %}
					<span class="patterntag">{{tag.content}}</span>
					{% endfor %}
				</div>
				
				{% if viewing != request.user and user.is_authenticated %}
					{% if pattern in request.user.saved_patterns.all%}
					<button type="button" class="save btn btn-custom" username="{{viewing.username}}" patternname="{{pattern.name}}" saved="True" disabled>
						Already saved </button>
					{% else %}
					<button type="button" class="save btn btn-custom" username="{{viewing.username}}" patternname="{{pattern.name}}" saved="False"> Save </button>
					{% endif %}
				{% endif %}

				{% if viewing == request.user %}
					<button class="delpattern" patternid="{{pattern.id}}">Delete pattern</button>
				{% endif %}

			</div>
		</div>

		{% endfor %}

	{% if unpublished %}
		<h2> Unpublished patterns (only visible to you) </h2>
			{% for pattern in unpublished %}
			<div class="patternbox">
				<div class="patternimage" style="height:200; width:200px; background-color:#FFB968;"></div>
				<div class="patterninfo">
					<div class="patternname"><a href="/{{pattern.user.username}}/{{pattern.id}}/">{{pattern.name}}</a> </div>
					<div class="patterncreated">Created {{pattern.date_created|date}}</div>
					<div class="patterntagset">
						{% for tag in pattern.tag_set.all %}
						<span class="patterntag">{{tag.content}}</span>
						{% endfor %}
					</div>
					<button class="delpattern" patternid="{{pattern.id}}">Delete</button>
				</div>
			</div>

			{% endfor %}
	{% endif %}

	<h1>Saved patterns</h1>
	{% for pattern in saved %}
		<div class="patternbox">
			<div class="patternimage" style="height:200px; width:200px; background-color:#FFB968;">
			</div>
			<div class="patterninfo">
				<div class="patternname">
					<a href="/{{pattern.user.username}}/{{pattern.id}}/">{{pattern.name}}</a> by 
					<a href="/{{pattern.user.username}}/">{{pattern.user.username}}</a>
				</div>
				<div class="patterncreated">{{pattern.date_published|date}}</div>
				<div class="patterntagset">
					{% for tag in pattern.tag_set.all %}
					<span class="patterntag">{{tag.content}}</span>
					{% endfor %}
				</div>
				
				{% if viewing == request.user %}
					<button type="button" class="remove" username="{{pattern.user.username}}" patternname="{{pattern.name}}">
						Remove </button>
				{% endif %}

			</div>
		</div>

		{% endfor %}
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
</body>
</html>